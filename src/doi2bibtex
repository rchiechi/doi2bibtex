#!/usr/bin/env python3

import opts
import util
import bibtex

args = opts.getopts()
logger = util.getlogger('doi2bib', root=True, loglevel=args.loglevel)

logger.debug("Debug logging enabled.")

journals = util.loadabbreviations(args.database,
                                  custom=args.custom,
                                  refresh=args.refresh)

library = None
if args.bibtexfile:
    library = bibtex.read(args.bibtexfile)
    logger.info(f"Parsed {len(library.entries)} from {args.bibtexfile}.")

dois = list(args.dois)
if args.fromfile:
    dois += util.doifinder(args.fromfile)
    logger.debug(dois)

for doi in dois:
    result = util.doitobibtex(doi)
    if result:
        library.add(result)
        logger.info(f"Added {doi} to library")

if library is not None:
    logger.info("Upadted library.")